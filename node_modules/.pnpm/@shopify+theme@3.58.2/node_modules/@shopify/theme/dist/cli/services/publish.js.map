{"version":3,"file":"publish.js","sourceRoot":"","sources":["../../../src/cli/services/publish.ts"],"names":[],"mappings":"AAAA,OAAO,EAAC,iBAAiB,EAAC,MAAM,gCAAgC,CAAA;AAChE,OAAO,EAAC,cAAc,EAAC,MAAM,0BAA0B,CAAA;AACvD,OAAO,EAAC,YAAY,EAAC,MAAM,kCAAkC,CAAA;AAC7D,OAAO,EAAC,eAAe,EAAC,MAAM,mCAAmC,CAAA;AAEjE,OAAO,EAAC,wBAAwB,EAAE,aAAa,EAAE,aAAa,EAAC,MAAM,0BAA0B,CAAA;AAG/F,MAAM,UAAU,sBAAsB,CAAC,EAAU;IAC/C,aAAa,CAAC;QACZ,IAAI,EAAE;YACJ,yDAAyD;YACzD,EAAC,OAAO,EAAE,SAAS,EAAC;YACpB,mBAAmB;YACnB,EAAC,OAAO,EAAE,mCAAmC,EAAE,EAAE,EAAC;YAClD,EAAC,IAAI,EAAE,GAAG,EAAC;SACZ;KACF,CAAC,CAAA;AACJ,CAAC;AAED,MAAM,CAAC,KAAK,UAAU,OAAO,CAAC,YAA0B,EAAE,OAA2B,EAAE,OAAyB;IAC9G,MAAM,KAAK,GAAG,MAAM,iBAAiB,CAAC,YAAY,EAAE;QAClD,MAAM,EAAE,2BAA2B;QACnC,MAAM,EAAE;YACN,WAAW,EAAE,KAAK;YAClB,IAAI,EAAE,KAAK;YACX,KAAK,EAAE,OAAO;SACf;KACF,CAAC,CAAA;IAEF,MAAM,UAAU,GAAG,eAAe,CAAC,EAAC,GAAG,KAAK,EAAE,IAAI,EAAE,MAAM,EAAU,EAAE,YAAY,CAAC,CAAA;IAEnF,IAAI,CAAC,OAAO,CAAC,KAAK,EAAE;QAClB,MAAM,MAAM,GAAG,MAAM,wBAAwB,CAAC;YAC5C,OAAO,EAAE,wBAAwB,KAAK,CAAC,IAAI,2BAA2B,YAAY,CAAC,SAAS,GAAG;YAC/F,mBAAmB,EAAE,cAAc,KAAK,CAAC,IAAI,sBAAsB;YACnE,mBAAmB,EAAE,oBAAoB;SAC1C,CAAC,CAAA;QACF,IAAI,CAAC,MAAM;YAAE,OAAM;KACpB;IAED,MAAM,YAAY,CAAC,KAAK,CAAC,EAAE,EAAE,YAAY,CAAC,CAAA;IAE1C,aAAa,CAAC;QACZ,IAAI,EAAE;YACJ,WAAW;YACX,GAAG,cAAc,CAAC,KAAK,CAAC;YACxB,gBAAgB;YAChB;gBACE,IAAI,EAAE;oBACJ,KAAK,EAAE,UAAU;oBACjB,GAAG,EAAE,UAAU;iBAChB;aACF;YACD,EAAC,IAAI,EAAE,GAAG,EAAC;SACZ;KACF,CAAC,CAAA;AACJ,CAAC","sourcesContent":["import {findOrSelectTheme} from '../utilities/theme-selector.js'\nimport {themeComponent} from '../utilities/theme-ui.js'\nimport {publishTheme} from '@shopify/cli-kit/node/themes/api'\nimport {themePreviewUrl} from '@shopify/cli-kit/node/themes/urls'\nimport {Theme} from '@shopify/cli-kit/node/themes/types'\nimport {renderConfirmationPrompt, renderSuccess, renderWarning} from '@shopify/cli-kit/node/ui'\nimport {AdminSession} from '@shopify/cli-kit/node/session'\n\nexport function renderArgumentsWarning(id: string) {\n  renderWarning({\n    body: [\n      'The theme ID positional argument is deprecated. Use the',\n      {command: '--theme'},\n      'flag instead:\\n\\n',\n      {command: `$ shopify theme publish --theme ${id}`},\n      {char: '.'},\n    ],\n  })\n}\n\nexport async function publish(adminSession: AdminSession, themeId: string | undefined, options: {force: boolean}) {\n  const theme = await findOrSelectTheme(adminSession, {\n    header: 'Select a theme to publish',\n    filter: {\n      development: false,\n      live: false,\n      theme: themeId,\n    },\n  })\n\n  const previewUrl = themePreviewUrl({...theme, role: 'live'} as Theme, adminSession)\n\n  if (!options.force) {\n    const accept = await renderConfirmationPrompt({\n      message: `Do you want to make '${theme.name}' the new live theme on ${adminSession.storeFqdn}?`,\n      confirmationMessage: `Yes, make '${theme.name}' the new live theme`,\n      cancellationMessage: 'No, cancel publish',\n    })\n    if (!accept) return\n  }\n\n  await publishTheme(theme.id, adminSession)\n\n  renderSuccess({\n    body: [\n      'The theme',\n      ...themeComponent(theme),\n      'is now live at',\n      {\n        link: {\n          label: previewUrl,\n          url: previewUrl,\n        },\n      },\n      {char: '.'},\n    ],\n  })\n}\n"]}