{"version":3,"file":"list.js","sourceRoot":"","sources":["../../../src/cli/services/list.ts"],"names":[],"mappings":"AAAA,OAAO,EAAC,OAAO,EAAC,MAAM,mBAAmB,CAAA;AACzC,OAAO,EAAC,mBAAmB,EAAC,MAAM,oBAAoB,CAAA;AACtD,OAAO,EAAC,aAAa,EAAE,gBAAgB,EAAO,MAAM,sCAAsC,CAAA;AAC1F,OAAO,EAAC,MAAM,EAAe,YAAY,EAAC,MAAM,uCAAuC,CAAA;AACvF,OAAO,EAAC,WAAW,EAAC,MAAM,0BAA0B,CAAA;AAEpD,OAAO,EAAC,YAAY,EAAC,MAAM,mCAAmC,CAAA;AAC9D,OAAO,EAAC,UAAU,EAAC,MAAM,8BAA8B,CAAA;AASvD,MAAM,CAAC,KAAK,UAAU,IAAI,CAAC,YAA0B,EAAE,OAAgB;IACrE,MAAM,KAAK,GAAG,YAAY,CAAC,SAAS,CAAA;IACpC,MAAM,MAAM,GAAG,IAAI,MAAM,CAAC;QACxB,GAAG,aAAa,CAAC,MAAM,CAAC,CAAC,KAAkB,EAAE,IAAI,EAAE,EAAE;YACnD,KAAK,CAAC,IAAI,CAAC,GAAG,OAAO,CAAC,IAAI,KAAK,IAAI,CAAA;YACnC,OAAO,KAAK,CAAA;QACd,CAAC,EAAE,EAAE,CAAC;QACN,KAAK,EAAE,OAAO,CAAC,EAAE,EAAE,QAAQ,EAAE,IAAI,OAAO,CAAC,IAAI;KAC9C,CAAC,CAAA;IAEF,IAAI,WAAW,GAAG,MAAM,gBAAgB,CAAC,YAAY,CAAC,CAAA;IACtD,MAAM,gBAAgB,GAAG,mBAAmB,EAAE,CAAA;IAC9C,MAAM,SAAS,GAAG,YAAY,CAAC,KAAK,CAAC,CAAA;IACrC,IAAI,MAAM,CAAC,GAAG,EAAE,EAAE;QAChB,WAAW,GAAG,YAAY,CAAC,KAAK,EAAE,WAAW,EAAE,MAAM,CAAC,CAAA;KACvD;IAED,IAAI,OAAO,CAAC,IAAI,EAAE;QAChB,OAAO,UAAU,CAAC,IAAI,CAAC,SAAS,CAAC,WAAW,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC,CAAA;KACxD;IAED,MAAM,MAAM,GAAG,WAAW,CAAC,GAAG,CAAC,CAAC,EAAC,EAAE,EAAE,IAAI,EAAE,IAAI,EAAC,EAAE,EAAE;QAClD,IAAI,aAAa,GAAG,EAAE,CAAA;QACtB,IAAI,IAAI,EAAE;YACR,aAAa,GAAG,IAAI,IAAI,GAAG,CAAA;YAC3B,IAAI,CAAC,gBAAgB,EAAE,SAAS,CAAC,CAAC,QAAQ,CAAC,GAAG,EAAE,EAAE,CAAC,EAAE;gBACnD,aAAa,IAAI,UAAU,CAAA;aAC5B;SACF;QACD,OAAO;YACL,EAAE,EAAE,IAAI,EAAE,EAAE;YACZ,IAAI;YACJ,IAAI,EAAE,aAAa;SACpB,CAAA;IACH,CAAC,CAAC,CAAA;IAEF,WAAW,CAAC,EAAC,IAAI,EAAE,MAAM,EAAE,OAAO,EAAC,CAAC,CAAA;AACtC,CAAC","sourcesContent":["import {columns} from './list.columns.js'\nimport {getDevelopmentTheme} from './local-storage.js'\nimport {ALLOWED_ROLES, fetchStoreThemes, Role} from '../utilities/theme-selector/fetch.js'\nimport {Filter, FilterProps, filterThemes} from '../utilities/theme-selector/filter.js'\nimport {renderTable} from '@shopify/cli-kit/node/ui'\nimport {AdminSession} from '@shopify/cli-kit/node/session'\nimport {getHostTheme} from '@shopify/cli-kit/node/themes/conf'\nimport {outputInfo} from '@shopify/cli-kit/node/output'\n\nexport interface Options {\n  role?: Role\n  name?: string\n  id?: number\n  json: boolean\n}\n\nexport async function list(adminSession: AdminSession, options: Options) {\n  const store = adminSession.storeFqdn\n  const filter = new Filter({\n    ...ALLOWED_ROLES.reduce((roles: FilterProps, role) => {\n      roles[role] = options.role === role\n      return roles\n    }, {}),\n    theme: options.id?.toString() ?? options.name,\n  })\n\n  let storeThemes = await fetchStoreThemes(adminSession)\n  const developmentTheme = getDevelopmentTheme()\n  const hostTheme = getHostTheme(store)\n  if (filter.any()) {\n    storeThemes = filterThemes(store, storeThemes, filter)\n  }\n\n  if (options.json) {\n    return outputInfo(JSON.stringify(storeThemes, null, 2))\n  }\n\n  const themes = storeThemes.map(({id, name, role}) => {\n    let formattedRole = ''\n    if (role) {\n      formattedRole = `[${role}]`\n      if ([developmentTheme, hostTheme].includes(`${id}`)) {\n        formattedRole += ' [yours]'\n      }\n    }\n    return {\n      id: `#${id}`,\n      name,\n      role: formattedRole,\n    }\n  })\n\n  renderTable({rows: themes, columns})\n}\n"]}