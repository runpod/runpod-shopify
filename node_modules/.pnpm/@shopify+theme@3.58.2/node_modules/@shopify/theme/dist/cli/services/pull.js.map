{"version":3,"file":"pull.js","sourceRoot":"","sources":["../../../src/cli/services/pull.ts"],"names":[],"mappings":"AAAA,OAAO,EAAC,aAAa,EAAC,MAAM,kCAAkC,CAAA;AAC9D,OAAO,EAAC,2BAA2B,EAAE,oBAAoB,EAAC,MAAM,0BAA0B,CAAA;AAC1F,OAAO,EAAC,yBAAyB,EAAE,cAAc,EAAC,MAAM,0BAA0B,CAAA;AAClF,OAAO,EAAC,2BAA2B,EAAC,MAAM,gCAAgC,CAAA;AAG1E,OAAO,EAAC,cAAc,EAAC,MAAM,kCAAkC,CAAA;AAC/D,OAAO,EAAC,aAAa,EAAC,MAAM,0BAA0B,CAAA;AACtD,OAAO,EAAC,IAAI,EAAC,MAAM,0BAA0B,CAAA;AAU7C,MAAM,CAAC,KAAK,UAAU,IAAI,CAAC,KAAY,EAAE,OAAqB,EAAE,OAAoB;IAClF,MAAM,IAAI,GAAG,OAAO,CAAC,IAAI,CAAA;IACzB,MAAM,KAAK,GAAG,OAAO,CAAC,KAAK,CAAA;IAE3B;;;;;OAKG;IACH,IACE,CAAC,CAAC,MAAM,UAAU,CAAC,IAAI,CAAC,CAAC;QACzB,CAAC,CAAC,MAAM,2BAA2B,CAAC,IAAI,CAAC,CAAC;QAC1C,CAAC,CAAC,MAAM,yBAAyB,CAAC,KAAK,CAAC,CAAC,EACzC;QACA,OAAM;KACP;IAED,MAAM,eAAe,GAAG,MAAM,cAAc,CAAC,KAAK,CAAC,EAAE,EAAE,OAAO,CAAC,CAAA;IAC/D,MAAM,eAAe,GAAG,MAAM,oBAAoB,CAAC,IAAI,CAAC,CAAA;IACxD,MAAM,cAAc,GAAG,2BAA2B,CAAC,eAAe,CAAC,CAAA;IAEnE,MAAM,KAAK,GAAG,OAAO,CAAC,SAAS,CAAA;IAC/B,MAAM,OAAO,GAAG,KAAK,CAAC,EAAE,CAAA;IAExB,MAAM,aAAa,CAAC,KAAK,EAAE,OAAO,EAAE,cAAc,EAAE,eAAe,EAAE,OAAO,CAAC,CAAA;IAE7E,aAAa,CAAC;QACZ,IAAI,EAAE,CAAC,WAAW,EAAE,GAAG,cAAc,CAAC,KAAK,CAAC,EAAE,kBAAkB,CAAC;QACjE,SAAS,EAAE;YACT;gBACE;oBACE,IAAI,EAAE;wBACJ,KAAK,EAAE,iBAAiB;wBACxB,GAAG,EAAE,WAAW,KAAK,sBAAsB,OAAO,EAAE;qBACrD;iBACF;aACF;YACD;gBACE;oBACE,IAAI,EAAE;wBACJ,KAAK,EAAE,0CAA0C;wBACjD,GAAG,EAAE,WAAW,KAAK,iBAAiB,OAAO,SAAS;qBACvD;iBACF;aACF;SACF;KACF,CAAC,CAAA;AACJ,CAAC;AAED,MAAM,CAAC,KAAK,UAAU,UAAU,CAAC,IAAY;IAC3C,MAAM,OAAO,GAAG,MAAM,IAAI,CAAC,GAAG,EAAE;QAC9B,GAAG,EAAE,IAAI;QACT,IAAI,EAAE,CAAC;QACP,SAAS,EAAE,KAAK;KACjB,CAAC,CAAA;IAEF,OAAO,OAAO,CAAC,MAAM,KAAK,CAAC,CAAA;AAC7B,CAAC","sourcesContent":["import {downloadTheme} from '../utilities/theme-downloader.js'\nimport {hasRequiredThemeDirectories, mountThemeFileSystem} from '../utilities/theme-fs.js'\nimport {currentDirectoryConfirmed, themeComponent} from '../utilities/theme-ui.js'\nimport {rejectGeneratedStaticAssets} from '../utilities/asset-checksum.js'\nimport {Theme} from '@shopify/cli-kit/node/themes/types'\nimport {AdminSession} from '@shopify/cli-kit/node/session'\nimport {fetchChecksums} from '@shopify/cli-kit/node/themes/api'\nimport {renderSuccess} from '@shopify/cli-kit/node/ui'\nimport {glob} from '@shopify/cli-kit/node/fs'\n\ninterface PullOptions {\n  path: string\n  nodelete: boolean\n  force: boolean\n  only?: string[]\n  ignore?: string[]\n}\n\nexport async function pull(theme: Theme, session: AdminSession, options: PullOptions) {\n  const path = options.path\n  const force = options.force\n\n  /**\n   * If users are not forcing the `pull` command, the directory is not empty,\n   * and the directory doesn't look like a theme directory, we ask for\n   * confirmation, because the `pull` command has the destructive behavior of\n   * removing local assets that are not present remotely.\n   */\n  if (\n    !(await isEmptyDir(path)) &&\n    !(await hasRequiredThemeDirectories(path)) &&\n    !(await currentDirectoryConfirmed(force))\n  ) {\n    return\n  }\n\n  const remoteChecksums = await fetchChecksums(theme.id, session)\n  const themeFileSystem = await mountThemeFileSystem(path)\n  const themeChecksums = rejectGeneratedStaticAssets(remoteChecksums)\n\n  const store = session.storeFqdn\n  const themeId = theme.id\n\n  await downloadTheme(theme, session, themeChecksums, themeFileSystem, options)\n\n  renderSuccess({\n    body: ['The theme', ...themeComponent(theme), 'has been pulled.'],\n    nextSteps: [\n      [\n        {\n          link: {\n            label: 'View your theme',\n            url: `https://${store}/?preview_theme_id=${themeId}`,\n          },\n        },\n      ],\n      [\n        {\n          link: {\n            label: 'Customize your theme at the theme editor',\n            url: `https://${store}/admin/themes/${themeId}/editor`,\n          },\n        },\n      ],\n    ],\n  })\n}\n\nexport async function isEmptyDir(path: string) {\n  const entries = await glob('*', {\n    cwd: path,\n    deep: 1,\n    onlyFiles: false,\n  })\n\n  return entries.length === 0\n}\n"]}