{"version":3,"file":"pull.js","sourceRoot":"","sources":["../../../../src/cli/commands/theme/pull.ts"],"names":[],"mappings":"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","sourcesContent":["import {themeFlags} from '../../flags.js'\nimport {ensureThemeStore} from '../../utilities/theme-store.js'\nimport ThemeCommand from '../../utilities/theme-command.js'\nimport {DevelopmentThemeManager} from '../../utilities/development-theme-manager.js'\nimport {showEmbeddedCLIWarning} from '../../utilities/embedded-cli-warning.js'\nimport {pull} from '../../services/pull.js'\nimport {findOrSelectTheme} from '../../utilities/theme-selector.js'\nimport {Flags} from '@oclif/core'\nimport {globalFlags} from '@shopify/cli-kit/node/cli'\nimport {execCLI2} from '@shopify/cli-kit/node/ruby'\nimport {ensureAuthenticatedThemes} from '@shopify/cli-kit/node/session'\nimport {useEmbeddedThemeCLI} from '@shopify/cli-kit/node/context/local'\n\nexport default class Pull extends ThemeCommand {\n  static summary = 'Download your remote theme files locally.'\n\n  static descriptionWithMarkdown = `Retrieves theme files from Shopify.\n\nIf no theme is specified, then you're prompted to select the theme to pull from the list of the themes in your store.`\n\n  static description = this.descriptionWithoutMarkdown()\n\n  static flags = {\n    ...globalFlags,\n    ...themeFlags,\n    theme: Flags.string({\n      char: 't',\n      description: 'Theme ID or name of the remote theme.',\n      env: 'SHOPIFY_FLAG_THEME_ID',\n    }),\n    development: Flags.boolean({\n      char: 'd',\n      description: 'Pull theme files from your remote development theme.',\n      env: 'SHOPIFY_FLAG_DEVELOPMENT',\n    }),\n    live: Flags.boolean({\n      char: 'l',\n      description: 'Pull theme files from your remote live theme.',\n      env: 'SHOPIFY_FLAG_LIVE',\n    }),\n    nodelete: Flags.boolean({\n      char: 'n',\n      description: 'Runs the pull command without deleting local files.',\n      env: 'SHOPIFY_FLAG_NODELETE',\n    }),\n    only: Flags.string({\n      char: 'o',\n      multiple: true,\n      description: 'Download only the specified files (Multiple flags allowed).',\n      env: 'SHOPIFY_FLAG_ONLY',\n    }),\n    ignore: Flags.string({\n      char: 'x',\n      multiple: true,\n      description: 'Skip downloading the specified files (Multiple flags allowed).',\n      env: 'SHOPIFY_FLAG_IGNORE',\n    }),\n    force: Flags.boolean({\n      hidden: true,\n      char: 'f',\n      description: 'Proceed without confirmation, if current directory does not seem to be theme directory.',\n      env: 'SHOPIFY_FLAG_FORCE',\n    }),\n    stable: Flags.boolean({\n      hidden: true,\n      description: 'Performs the pull command by relying on the legacy download implementation.',\n      env: 'SHOPIFY_FLAG_STABLE',\n    }),\n    beta: Flags.boolean({\n      hidden: true,\n      description: 'Performs the pull command by relying on the new download implementation.',\n      env: 'SHOPIFY_FLAG_BETA',\n    }),\n  }\n\n  static cli2Flags = ['theme', 'development', 'live', 'nodelete', 'only', 'ignore', 'force', 'development-theme-id']\n\n  async run(): Promise<void> {\n    showEmbeddedCLIWarning()\n\n    const {flags} = await this.parse(Pull)\n    const store = ensureThemeStore(flags)\n    const adminSession = await ensureAuthenticatedThemes(store, flags.password)\n\n    const developmentThemeManager = new DevelopmentThemeManager(adminSession)\n    const developmentTheme = await (flags.development\n      ? developmentThemeManager.find()\n      : developmentThemeManager.fetch())\n\n    if (flags.beta) {\n      const {path, nodelete, live, development, only, ignore, force} = flags\n\n      const theme = await findOrSelectTheme(adminSession, {\n        header: 'Select a theme to open',\n        filter: {\n          live,\n          theme: development ? `${developmentTheme?.id}` : flags.theme,\n        },\n      })\n\n      await pull(theme, adminSession, {path, nodelete, only, ignore, force})\n\n      return\n    }\n\n    if (developmentTheme) {\n      if (flags.development) {\n        flags.theme = `${developmentTheme.id}`\n        flags.development = false\n      }\n      if (useEmbeddedThemeCLI()) {\n        flags['development-theme-id'] = developmentTheme.id\n      }\n    }\n\n    const flagsToPass = this.passThroughFlags(flags, {allowedFlags: Pull.cli2Flags})\n    const command = ['theme', 'pull', flags.path, ...flagsToPass]\n\n    await execCLI2(command, {store, adminToken: adminSession.token})\n  }\n}\n"]}