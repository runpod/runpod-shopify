{"version":3,"file":"delete.js","sourceRoot":"","sources":["../../../src/cli/services/delete.ts"],"names":[],"mappings":"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","sourcesContent":["import {removeDevelopmentTheme} from './local-storage.js'\nimport {findOrSelectTheme, findThemes} from '../utilities/theme-selector.js'\nimport {themeComponent, themesComponent} from '../utilities/theme-ui.js'\nimport {DevelopmentThemeManager} from '../utilities/development-theme-manager.js'\nimport {deleteTheme} from '@shopify/cli-kit/node/themes/api'\nimport {AdminSession} from '@shopify/cli-kit/node/session'\nimport {\n  renderConfirmationPrompt,\n  RenderConfirmationPromptOptions,\n  renderSuccess,\n  renderWarning,\n  InlineToken,\n  LinkToken,\n} from '@shopify/cli-kit/node/ui'\nimport {pluralize} from '@shopify/cli-kit/common/string'\nimport {Theme} from '@shopify/cli-kit/node/themes/types'\nimport {isDevelopmentTheme} from '@shopify/cli-kit/node/themes/utils'\n\nexport interface DeleteOptions {\n  selectTheme: boolean\n  development: boolean\n  force: boolean\n  themes: string[]\n}\n\nexport async function deleteThemes(adminSession: AdminSession, options: DeleteOptions) {\n  let themeIds = options.themes\n  if (options.development) {\n    const theme = await new DevelopmentThemeManager(adminSession).find()\n    themeIds = [theme.id.toString()]\n  }\n\n  const store = adminSession.storeFqdn\n  const themes = await findThemesByDeleteOptions(adminSession, {...options, themes: themeIds, development: false})\n\n  if (!options.force && !(await isConfirmed(themes, store))) {\n    return\n  }\n\n  themes.map((theme) => {\n    if (isDevelopmentTheme(theme)) {\n      removeDevelopmentTheme()\n    }\n    return deleteTheme(theme.id, adminSession)\n  })\n\n  renderSuccess({\n    body: pluralize(\n      themes,\n      (themes) => [`The following themes were deleted from ${store}:`, themesComponent(themes)],\n      (theme) => ['The theme', ...themeComponent(theme), `was deleted from ${store}.`],\n    ),\n  })\n}\n\nasync function findThemesByDeleteOptions(adminSession: AdminSession, options: DeleteOptions) {\n  if (options.selectTheme || options.themes.length > 0) {\n    return findThemes(adminSession, options)\n  }\n\n  const store = adminSession.storeFqdn\n  const theme = await findOrSelectTheme(adminSession, {\n    header: `Select a theme to delete from ${store}`,\n    filter: {development: options.development},\n  })\n\n  return [theme]\n}\n\nasync function isConfirmed(themes: Theme[], store: string) {\n  const message = pluralize<Theme, Exclude<InlineToken, LinkToken>>(\n    themes,\n    (_themes) => [`Delete the following themes from ${store}?`],\n    (theme) => ['Delete', ...themeComponent(theme), `from ${store}?`],\n  )\n\n  const options: RenderConfirmationPromptOptions = {\n    message,\n    confirmationMessage: 'Yes, confirm changes',\n    cancellationMessage: 'Cancel',\n  }\n\n  if (themes.length > 1) {\n    options.infoTable = {'': themes.map(themeComponent)}\n  }\n\n  return renderConfirmationPrompt(options)\n}\n\nexport function renderDeprecatedArgsWarning(argv: string[]) {\n  const ids = argv.join(' ')\n\n  renderWarning({\n    body: [\n      'Positional arguments are deprecated. Use the',\n      {command: '--theme'},\n      'flag instead:\\n\\n',\n      {command: `$ shopify theme delete --theme ${ids}`},\n      {char: '.'},\n    ],\n  })\n}\n"]}