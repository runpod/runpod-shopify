"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.parseJSON = void 0;
const utils_1 = require("./utils");
const jsonc_parser_1 = require("jsonc-parser");
const PARSE_OPTS = {
    disallowComments: false,
    allowTrailingComma: true,
    allowEmptyContent: false,
};
function parseJSON(source, defaultValue) {
    try {
        /**
         * The jsonc-parser is fault-tolerant and typically returns a valid
         * result. However, it also mutates the 'errors' array with any
         * errors it encounters during parsing.
         */
        const errors = [];
        const result = (0, jsonc_parser_1.parse)(source, errors, PARSE_OPTS);
        if (errors.length) {
            throw errors[0];
        }
        return result;
    }
    catch (error) {
        if (defaultValue !== undefined)
            return defaultValue;
        return (0, utils_1.asError)(error);
    }
}
exports.parseJSON = parseJSON;
//# sourceMappingURL=json.js.map